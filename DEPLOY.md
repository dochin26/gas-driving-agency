# デプロイ手順

## 1. LINE Messaging APIの設定

### 1.1 LINE Developersコンソールでチャネルを作成
1. https://developers.line.biz/console/ にアクセス
2. 新しいプロバイダーを作成（または既存のものを選択）
3. 「Messaging API」チャネルを作成
4. チャネル基本設定から以下を取得：
   - Channel Access Token（発行ボタンを押して生成）

### 1.2 Channel Access Tokenを設定
`Config.js` の1行目を編集：
```javascript
const LINE_CHANNEL_ACCESS_TOKEN = 'ここにChannel Access Tokenを貼り付け';
```

## 2. スプレッドシートの準備

### 2.1 シートを作成
SPSHE.mdに記載のスプレッドシートに以下のシートを作成してください：

#### 運転記録シート
1行目（ヘッダー）：
```
No | 出発日時 | 出発地点 | 店舗名 | 経由地 | 到着日時 | 目的地 | 走行距離 | 金額 | 車両番号 | 備考
```

#### ユーザー管理シート
1行目（ヘッダー）：
```
No | LINE User ID | 現在の状態 | 一時データ | 最終更新日時
```

#### 車両設定シート
1行目（ヘッダー）：
```
No | 車両番号 | 車両情報
```
2行目以降にデータを追加（例）：
```
1 | 1号車 | プリウス
2 | 2号車 | アルファード
```

#### 店舗登録シート
1行目（ヘッダー）：
```
No | 店舗名 | 住所
```
2行目以降にデータを追加（例）：
```
1 | 居酒屋A | 東京都渋谷区...
2 | レストランB | 東京都新宿区...
```

#### 日報範囲設定シート
1行目（ヘッダー）：
```
No | 開始 | 終了
```
2行目にデータを追加（例：19時から翌朝4時まで）：
```
1 | 19 | 28
```
※終了が28の場合、翌日4時（24+4）を意味します

## 3. Google Apps Scriptへのデプロイ

### 3.1 claspでプッシュ
```bash
clasp push
```

### 3.2 デプロイ
1. `clasp open` でスクリプトエディタを開く
2. 右上の「デプロイ」→「新しいデプロイ」をクリック
3. 種類：「ウェブアプリ」を選択
4. 設定：
   - 説明：任意（例：運転代行管理Bot v1）
   - 次のユーザーとして実行：自分
   - アクセスできるユーザー：全員
5. 「デプロイ」をクリック
6. **ウェブアプリのURL**をコピー

### 3.3 権限の承認
初回デプロイ時、権限の承認が必要です：
1. 「承認が必要です」と表示されたら「アクセスを承認」
2. Googleアカウントを選択
3. 「詳細」→「（プロジェクト名）に移動」をクリック
4. 「許可」をクリック

## 4. LINE WebhookのURL設定

### 4.1 Webhook URLを設定
1. LINE Developersコンソールに戻る
2. 「Messaging API」タブを開く
3. 「Webhook URL」に手順3.2でコピーしたURLを貼り付け
4. 「Webhookの利用」をONに設定
5. 「検証」ボタンをクリックして疎通確認

### 4.2 応答設定
1. LINE公式アカウント設定へ移動
2. 「応答設定」を開く
3. 「応答メッセージ」をOFF
4. 「Webhook」をONに設定

## 5. 動作確認

### 5.1 友だち追加
LINE Developersコンソールの「Messaging API」タブにあるQRコードで友だち追加

### 5.2 テスト
1. 「新規」とメッセージを送信
2. 案内に従って入力
3. スプレッドシートにデータが保存されることを確認

## トラブルシューティング

### エラーが発生する場合
1. Google Apps Scriptのログを確認：
   ```bash
   clasp logs
   ```
2. Config.jsのLINE_CHANNEL_ACCESS_TOKENが正しいか確認
3. Config.jsのSPREADSHEET_IDが正しいか確認
4. スプレッドシートのシート名が仕様通りか確認

### 最小限の実装について
現在は**新規登録機能のみ**実装されています。
以下の機能は未実装です：
- 日報機能
- 削除機能
- 編集機能
- リッチメニュー

これらの機能が必要な場合は、追加実装をリクエストしてください。

## 次のステップ

動作確認が取れたら、以下を実装できます：
1. リッチメニューの設定
2. 日報機能の実装
3. 削除機能の実装
4. 編集機能の実装
5. Flex Messageのデザイン改善
